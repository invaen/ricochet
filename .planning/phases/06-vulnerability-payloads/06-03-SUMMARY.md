---
phase: 06-vulnerability-payloads
plan: 03
subsystem: payloads
tags: [ssti, jinja2, freemarker, twig, template-injection, rce]

# Dependency graph
requires:
  - phase: 05-crawler-payloads
    provides: load_payloads function for reading payload files
provides:
  - SSTIPayloadGenerator class for SSTI callback payloads
  - Engine-specific payload files (jinja2, freemarker, twig)
affects: [06-vulnerability-payloads, payload-integration]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Engine selection parameter for targeted payload generation"
    - "Command execution payloads (curl/nslookup) for callbacks"

key-files:
  created:
    - ricochet/payloads/ssti.py
    - ricochet/payloads/builtin/ssti-jinja2.txt
    - ricochet/payloads/builtin/ssti-freemarker.txt
    - ricochet/payloads/builtin/ssti-twig.txt
    - tests/test_payloads_ssti.py
  modified: []

key-decisions:
  - "Engine parameter for targeted vs broad SSTI testing"
  - "curl/nslookup command pairs for HTTP and DNS callbacks"

patterns-established:
  - "Engine selection: Optional engine param filters to specific template engine"
  - "Payload tuple format: (payload, engine) metadata pattern"

# Metrics
duration: 2min
completed: 2026-01-30
---

# Phase 6 Plan 3: SSTI Payload Generator Summary

**Server-side template injection payloads for Jinja2, Freemarker, and Twig using command execution callbacks**

## Performance

- **Duration:** 2 min
- **Started:** 2026-01-30T06:37:44Z
- **Completed:** 2026-01-30T06:39:43Z
- **Tasks:** 2
- **Files created:** 5

## Accomplishments
- Created engine-specific SSTI payload files (2 payloads each)
- Implemented SSTIPayloadGenerator with optional engine targeting
- Added comprehensive test suite (12 tests)
- Verified 6 payloads covering Jinja2, Freemarker, and Twig

## Task Commits

Each task was committed atomically:

1. **Task 1: Create SSTI builtin payload files** - `3e40443` (feat)
2. **Task 2: Create SSTI payload generator with engine selection** - `3de04a7` (feat)

## Files Created/Modified
- `ricochet/payloads/ssti.py` - SSTI payload generator with engine selection
- `ricochet/payloads/builtin/ssti-jinja2.txt` - Jinja2 payloads using lipsum.__globals__
- `ricochet/payloads/builtin/ssti-freemarker.txt` - Freemarker payloads using Execute class
- `ricochet/payloads/builtin/ssti-twig.txt` - Twig payloads using sort filter with system
- `tests/test_payloads_ssti.py` - 12 tests covering all generator functionality

## Decisions Made
- **Engine parameter:** Optional engine param enables targeted testing (e.g., only Jinja2) or broad coverage (all engines)
- **Command execution:** Each engine uses curl and nslookup variants for HTTP and DNS callback options
- **Invalid engine handling:** Raises ValueError with helpful message listing supported engines

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- SSTI generator ready for integration with Injector
- Follows same pattern as XSSPayloadGenerator
- All 12 tests passing

---
*Phase: 06-vulnerability-payloads*
*Completed: 2026-01-30*
