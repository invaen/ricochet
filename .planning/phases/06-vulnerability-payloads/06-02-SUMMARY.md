---
phase: 06-vulnerability-payloads
plan: 02
subsystem: payloads
tags: [sqli, oob, database, payload-generation]
depends_on:
  requires: [05-02]  # load_payloads function
  provides: [SQLiPayloadGenerator, sqli-dns-*.txt]
  affects: [07-xx]  # reporting will reference vuln_type
tech_stack:
  added: []
  patterns: [payload-generator-class, database-specific-payloads]
key_files:
  created:
    - ricochet/payloads/sqli.py
    - ricochet/payloads/builtin/sqli-dns-mssql.txt
    - ricochet/payloads/builtin/sqli-dns-mysql.txt
    - ricochet/payloads/builtin/sqli-dns-oracle.txt
    - ricochet/payloads/builtin/sqli-dns-postgres.txt
    - tests/test_payloads_sqli.py
  modified:
    - ricochet/core/store.py
    - ricochet/external/interactsh.py
    - ricochet/injection/crawler.py
    - ricochet/server/dns.py
    - ricochet/server/http.py
decisions:
  - id: 06-02-01
    decision: "3 payloads per database (exceeds 2 minimum)"
    rationale: "More coverage for different injection contexts"
  - id: 06-02-02
    decision: "Python 3.9 type hint compatibility fix"
    rationale: "Production environment uses Python 3.9.6"
metrics:
  duration: 3 min
  completed: 2026-01-30
---

# Phase 06 Plan 02: SQLi OOB Payload Generator Summary

SQLi OOB payload generator with database-specific payload files for MSSQL, MySQL, Oracle, and PostgreSQL

## What Was Built

### SQLi Payload Files (12 total)
- **MSSQL (3):** xp_dirtree and xp_fileexist via UNC paths
- **MySQL (3):** LOAD_FILE with UNC path DNS exfiltration
- **Oracle (3):** UTL_HTTP, UTL_INADDR, DBMS_LDAP techniques
- **PostgreSQL (3):** dblink, COPY TO PROGRAM, inet_client_addr

### SQLiPayloadGenerator Class
```python
class SQLiPayloadGenerator:
    vuln_type = "sqli"
    DATABASES = ["mssql", "mysql", "oracle", "postgres"]

    def __init__(self, database: Optional[str] = None):
        # If None, generates for all databases

    def generate(self, callback_url: str) -> Iterator[tuple[str, str]]:
        # Yields (payload, database) tuples
```

## Key Implementation Details

1. **Database-specific filtering:** Pass database name to constructor for targeted payloads
2. **Callback substitution:** `{{CALLBACK}}` placeholder replaced with actual callback URL
3. **Consistent interface:** Same pattern as future XSS, SSRF generators
4. **File-based payloads:** Easy to extend by editing/adding .txt files

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Python 3.9 compatibility fix**
- **Found during:** Task 2 (import test)
- **Issue:** Python 3.9 doesn't support `x | None` union syntax (added in 3.10)
- **Fix:** Changed all `x | None` type hints to `Optional[x]` across 5 files
- **Files modified:** store.py, interactsh.py, crawler.py, dns.py, http.py
- **Commit:** d011688

## Commits

| Hash | Type | Description |
|------|------|-------------|
| a5babc9 | feat | Add SQLi OOB payload files for 4 databases |
| d011688 | fix | Python 3.9 compatibility for type hints |
| f1458f9 | feat | Add SQLi OOB payload generator |

## Verification Results

```
12 SQLi payloads across databases
Databases: {'postgres', 'mysql', 'mssql', 'oracle'}
3 MSSQL payloads (database-specific mode)
12/12 tests passed
```

## Next Phase Readiness

- SQLiPayloadGenerator ready for integration with injection engine
- Pattern established for XSS and SSRF generators (Plan 06-03, 06-04)
- All payload files in `ricochet/payloads/builtin/` following naming convention
